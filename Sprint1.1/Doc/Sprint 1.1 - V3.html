<!doctype html>
<html>
    <head>
        <title>Sprint 1.1 - V3</title>
        <meta charset='utf-8'/>
    </head>
    <body>
<h3 data-heading="Goal Sprint 1.1">Goal Sprint 1.1</h3>
<p>TicketHandler + ServiceAccessGUI.</p>
<div data-callout-metadata="" data-callout-fold="-" data-callout="note" class="callout is-collapsible is-collapsed"><div class="callout-title"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">Descrizione</div><div class="callout-fold is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-chevron-down"><path d="m6 9 6 6 6-6"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div></div><div class="callout-content" style="display: none;">
<p>In questa seconda parte del primo sprint verrà trattata la logica dei ticket, i componenti e la sicurezza associati.</p>
</div></div>
<p>Modello dello <a data-tooltip-position="top" aria-label="Sprint 1.0 - V3" data-href="Sprint 1.0 - V3" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint%201.0%20-%20V3" class="internal-link" target="_blank" rel="noopener">sprint precedente</a>.<br>
<img alt="ArchitetturaLogica_Sprint1.0-V2.png" src="ArchitetturaLogica_Sprint1.0-V2.png" class="internal-embed"></p>
<h3 data-heading="Requisiti">Requisiti</h3>
<p><img alt="ColdStorageServiceRoomAnnoted.png" src="ColdStorageServiceRoomAnnoted.png" class="internal-embed"><br>
<a data-tooltip-position="top" aria-label="Cold Storage Service - Natali V3 > Requisiti" data-href="Cold Storage Service - Natali V3#Requisiti" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Cold%20Storage%20Service%20-%20Natali%20V3.html#Requisiti" class="internal-link" target="_blank" rel="noopener">Requisiti</a></p>
<h3 data-heading="Analisi dei Requisiti">Analisi dei Requisiti</h3>
<p><a data-tooltip-position="top" aria-label="Cold Storage Service - Natali V3 > Analisi preliminare dei requisiti" data-href="Cold Storage Service - Natali V3#Analisi preliminare dei requisiti" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Cold%20Storage%20Service%20-%20Natali%20V3.html#Analisi%20preliminare%20dei%20requisiti" class="internal-link" target="_blank" rel="noopener">requisiti sprint 0</a></p>
<h3 data-heading="Analisi del Problema">Analisi del Problema</h3>
<h5 data-heading="Compiti di TicketHandler">Compiti di TicketHandler</h5>
<p>TicketHandler si occuperà di:</p>
<ol>
<li>verificare se è possibile generare il Ticket richiesto;</li>
<li>generare i Ticket;</li>
<li>verificare se il Ticket ricevuto è scaduto o meno.
<div data-callout-metadata="" data-callout-fold="-" data-callout="note" class="callout is-collapsible is-collapsed"><div class="callout-title"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">motivazioni</div><div class="callout-fold is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-chevron-down"><path d="m6 9 6 6 6-6"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div></div><div class="callout-content" style="display: none;">
<ol>
<li>Principio di singola responsabilità: Il TicketHandler ha la responsabilità di gestire i Ticket, di conseguenza è corretto che sia quest'ultimo ad occuparsi sia di generare i Ticket richiesti sia di verificarne la validità.</li>
<li>Motivi di sicurezza: si preferisce assegnare la verifica al TicketHandler, avendo lui tutte le informazioni del driver necessarie per generare e verificare i Ticket stessi (ad esempio l'istante di emissione o l'id del driver associato al ticket).</li>
</ol>
</div></div>
</li>
</ol>
<p>La separazione di TicketHandler e Controller porta l'utente a dover potenzialmente interagire con due entità diverse del sistema. Decidiamo di introdurre un componente intermedio per nascondere questa complessità dal lato dell'utente secondo il modello del <strong>pattern facade</strong>.</p>
<p>Il sistema sarà dunque ampliato secondo la seguente <strong>Architettura logica</strong>:<br>
<img alt="ArchitetturaLogica_Sprint1.1.png" src="ArchitetturaLogica_Sprint1.1.png" class="internal-embed"></p>
<h5 data-heading="Protocollo di richiesta e generazione del ticket">Protocollo di richiesta e generazione del ticket</h5>
<p><img alt="Sprint1.1/Doc/cicloVitaMessaggi.png" src="Sprint1.1/Doc/cicloVitaMessaggi.png" class="internal-embed"></p>
<ol>
<li>Inizia con una request/response dal driver verso TicketHandler</li>
</ol>
<pre><code>Request depositRequest : depositRequest(PESO)
Reply accept : accept(TICKET)
Reply reject : reject(NO_PARAM)
</code><button class="copy-code-button">Copy</button></pre>
<ol start="2">
<li>TicketHandler chiede a ColdRoom se c'è abbastanza spazio;</li>
</ol>
<pre><code>Request weightrequest : weightrequest(PESO)
Reply weightOK : weightOK( NO_PARAM )
Reply weightKO : weightKO( NO_PARAM )
</code><button class="copy-code-button">Copy</button></pre>
<ol start="3">
<li>Se c'è abbastanza spazio, ColdRoom aggiorna i propri attributi;</li>
<li>Se TicketHandler riceve True genera il ticket e lo invia a ServiceAccessGui, altrimenti rejected;</li>
<li>Arrivato in INDOOR, il driver, invia il Ticket a TicketHandler. Il TicketHandler verifica il <strong>TICKETTIME</strong> e restituisce Ok / Rejected;</li>
</ol>
<pre><code>Request checkmyticket : checkmyticket(TICKET)
Reply	ticketchecked : ticketchecked(BOOL)
</code><button class="copy-code-button">Copy</button></pre>
<ol start="6">
<li>Se la richiesta viene approvata ServiceAccessGUI invia "loaddone" al Controller per notificare che il FridgeTruck è pronto, col peso da scaricare. Il Controller risponderà con "chargetaken".</li>
</ol>
<pre><code>Request loaddone : loaddone(PESO)
Reply 	chargetaken : chargetaken(NO_PARAM)
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="Quando viene inviato il &quot;charge taken&quot;?">Quando viene inviato il "charge taken"?</h5>
<p>"chargetaken" viene inviato dal Controller subito dopo la "doJob" associata alla richiesta.</p>
<div data-callout-metadata="" data-callout-fold="-" data-callout="note" class="callout is-collapsible is-collapsed"><div class="callout-title"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">motivazioni</div><div class="callout-fold is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-chevron-down"><path d="m6 9 6 6 6-6"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div></div><div class="callout-content" style="display: none;">
<ol>
<li>Supponiamo che quest'ultimo scarichi la merce in una piattaforma dedicata, dalla quale il DDR robot preleverà il cibo e lo scaricherà in ColdRoom in uno o più volte a seconda della quantità di materiale dichiarata.</li>
<li>Al driver non interessa sapere se il TransportTrolley ha avuto problematiche durante il trasporto del materiale, quindi il "charge taken" può essere inviato prima che il TransportTrolley comunichi al Controller se il carico/scarico in ColdRoom è terminato. </li>
</ol>
</div></div>
<p>Ricevuta la "chargetaken" il driver può uscire dal sistema considerando la transizione conclusa con successo.</p>
<h5 data-heading="Problema del peso ipotetico">Problema del peso ipotetico</h5>
<p>Un driver potrebbe inviare la richiesta di un Ticket prima che un secondo driver, a cui è stato generato un Ticket in precedenza, abbiano scaricato.<br>
Rischio di emettere un ticket per un peso non realmente disponibile nel momento di scarico.</p>
<p>Per risolvere il problema definiamo due pesi diversi: </p>
<ol>
<li>Peso effettivo : quantità (peso) di cibo contenuto in ColdRoom nell'istante attuale. Aggiornato dopo l'azione del TransportTrolley.</li>
<li>Peso promesso : quantità di peso richiesta dai driver tramite Ticket non ancora scaricato, incrementato dopo l'emissione di un ticket e decrementato dopo l'azione del Transport Trolley o a seguito della scadenza della validità di un Ticket.</li>
</ol>
<p>Useremo la somma dei due pesi per validare o meno una richiesta di emissione ticket.</p>
<pre><code>QActor coldroom context ctxcoldstoragearea {
	[#
		var PesoEffettivo = 0
		var PesoPromesso = 0 
		var MAXW = 50
	#]
	
	State updateWeight {
		onMsg ( updateWeight : updateWeight(P_EFF, P_PRO) ) {
			[# PesoEffettivo += P_EFF 
			   PesoPromesso -= P_PRO
			#]
		}
	}
	
	State checkweight {
		onMsg(weightrequest : weightrequest(PESO)){
			[# var PesoRichiesto = PESO #]
			
			if [# PesoEffettivo + PesoPromesso + PesoRichiesto  &lt;= MAXW #]	{
				[# PesoPromesso += PesoRichiesto #]
				replyTo weightrequest with weightOK : weightOK( NO_PARAM)
			} else {
				replyTo weightrequest with weightKO : weightKO( NO_PARAM )
			}
		}
	}
}
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="Problema del peso fantasma">Problema del peso fantasma</h5>
<p>A seguito della scadenza di un Ticket, il Transport Trolley non si farà carico della richiesta e il peso promesso del ticket rimarrà considerato in Cold Room.</p>
<h5 data-heading="Gestione dei Ticket scaduti">Gestione dei Ticket scaduti</h5>
<p>L'eliminazione dei ticket scaduti viene fatta per necessità.</p>
<p>All'arrivo di una richiesta di emissione del Ticket, se lo spazio calcolato non fosse sufficiente si verifica il TICKETTIME associato ai Ticket generati e non ancora scaricati.</p>
<p>In presenza di Ticket scaduti allora il TicketHandler procederà ad aggiornare il peso promesso tramite dispatch "updateWeight".<br>
In questo modo risolviamo anche il <a data-tooltip-position="top" aria-label="Sprint 1.1 - V3 > Problema del peso fantasma" data-href="Sprint 1.1 - V3#Problema del peso fantasma" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint%201.1%20-%20V3#Problema%20del%20peso%20fantasma" class="internal-link" target="_blank" rel="noopener">problema del peso fantasma</a>.</p>
<h5 data-heading="Quando e da chi vengono aggiornati i pesi in ColdRoom?">Quando e da chi vengono aggiornati i pesi in ColdRoom?</h5>
<ol>
<li>
<p>Terminata l'azione del Transport Trolley, Controller aggiorna i due pesi tramite dispatch. Viene passata la quantità da decrementare dal peso promesso e la quantità da incrementare al peso effettivo.</p>
</li>
<li>
<p>Caso particolare: i pesi sono aggiornati da TicketHandler tramite dispatch "updateWeight" nella <a data-tooltip-position="top" aria-label="Sprint 1.1 - V3 > Gestione dei Ticket scaduti" data-href="Sprint 1.1 - V3#Gestione dei Ticket scaduti" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint%201.1%20-%20V3#Gestione%20dei%20Ticket%20scaduti" class="internal-link" target="_blank" rel="noopener">gestione dei ticket scaduti</a>.</p>
</li>
</ol>
<h5 data-heading="Sicurezza dei Ticket">Sicurezza dei Ticket</h5>
<p>Dall'analisi della sicurezza sono apparse le seguenti vulnerabilità:</p>
<ol>
<li>Bisogna assicurarsi che chi richiede il ticket sia l'unico a poterlo usare.</li>
<li>Ulteriori dati potrebbero essere visibili ad un utente malevolo (Peso scaricato, ecc...).</li>
<li>Un ticket non deve essere riutilizzabile da un qualsiasi utente.</li>
<li>Possibile DoS di un utente che richiede troppi ticket e occupa tutto il peso disponibile.</li>
<li>Possibile modifica malevola del Ticket dopo l'emissione.</li>
</ol>
<p>Dei punti definiti, parlando col committente, dovremmo rispettare solo 1 e 3.</p>
<div data-callout-metadata="" data-callout-fold="-" data-callout="note" class="callout is-collapsible is-collapsed"><div class="callout-title"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">soluzioni possibili</div><div class="callout-fold is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-chevron-down"><path d="m6 9 6 6 6-6"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div></div><div class="callout-content" style="display: none;">
<ol>
<li>
<p>Devo assicurarmi che la risposta con il ticket generato venga inviata solo a chi ha fatto la richiesta iniziale e non sia visibile anche agli altri utenti collegati.</p>
</li>
<li>
<p>Avendo già l'elenco dei ticket emessi in TicketHandler per controllare i ticket scaduti posso imporre che ogni ticket che ricevo debba essere dentro quella lista e rimuoverlo appena lo ricevo, in questo modo un ticket non può essere presentato più di una volta.</p>
</li>
</ol>
</div></div>
<h5 data-heading="Gestione dei parametri di sistema">Gestione dei parametri di sistema</h5>
<p>TICKETTIME è un parametro variabile al lancio del sistema. Definiamo un file di configurazione con i valori da caricare al lancio (AppConfig.json):</p>
<pre class="language-json" tabindex="0"><code class="language-json is-loaded"><span class="token punctuation">{</span>  
 <span class="token property">"TicketTime"</span><span class="token operator">:</span> <span class="token string">"600"</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre>
<pre><code>QActor tickethandler context ctxcoldstoragearea {
	[# var TICKETTIME = GetTicketTimeFromConfigFile(); #]
	...
}
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="ServiceAccessGUI">ServiceAccessGUI</h5>
<p>Progettare le GUI come attori non è ottimale, dobbiamo progettarla come un componente alieno al sistema che si interfacci con esso.<br>
Per fare ciò ci appoggiamo alla tecnologia di SPRING che permette l'interazione tramite web e la gestione di molti utenti collegati contemporaneamente.</p>
<p>Nello schema iniziale il server Spring prenderà quindi il posto dell'attore ServiceAccessGUI, l'interazione con l'utente avverrà tramite pagine html statiche fornite dal server ad ogni utente che si collega.</p>
<p><img alt="SpringStructure.png" src="SpringStructure.png" class="internal-embed"></p>
<h5 data-heading="Aggiornamento peso in ServiceAccessGUI">Aggiornamento peso in ServiceAccessGUI</h5>
<p>La soluzione migliore sarebbe metterlo in ascolto dei cambiamenti a ColdRoom, ColdRoom diventa observable come da analisi preliminari.<br>
In alternativa Req/Resp di deposit weigth fa una richiesta per sapere il peso in coldRoom.<br>
In entrambi i casi usiamo la somma tra peso effettivo e peso promesso.</p>
<p><strong>PROBLEMA:</strong> Usando pagine html statiche, anche mantenendo aggiornato il peso corrente nel server spring l'utente deve ricaricare la pagina per visualizzare il nuovo peso.<br>
Motivo per il quale abbiamo deciso di cambiare verso pagine html dinamiche.</p>
<h5 data-heading="Architettura logica dopo l'analisi del problema">Architettura logica dopo l'analisi del problema</h5>
<p><img alt="coldstorage11arch.png" src="coldstorage11arch.png" class="internal-embed"></p>
<h3 data-heading="Test Plan">Test Plan</h3>
<p>Durante la fase di testing dovranno essere verificati i seguenti casi:</p>
<ol>
<li>Test del processo in condizioni normali</li>
<li>Test con ticket scaduto </li>
<li>Test con ticket ripetuto</li>
<li>Test con peso superiore al disponibile</li>
<li>Controllare che quando il controller aggiorna la ColdRoom il cambiamento di peso risulti nella service access gui.<br>
Ciascuno dei test deve essere superato con più utenti collegati contemporaneamente da uno stesso browser o da browser diversi.</li>
</ol>
<p>Codice secondo test: <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/ColdStorageSprint2/test/TestService.java" data-href="Sprint1.1/Codice/ColdStorageSprint2/test/TestService.java" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\ColdStorageSprint2\test\TestService.java" class="internal-link" target="_blank" rel="noopener">TestService</a></p>
<h3 data-heading="Progettazione">Progettazione</h3>
<p><a data-tooltip-position="top" aria-label="Sprint1.1/Codice/ColdStorageSprint2/src/coldstorage.qak" data-href="Sprint1.1/Codice/ColdStorageSprint2/src/coldstorage.qak" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\ColdStorageSprint2\src\coldstorage.qak" class="internal-link" target="_blank" rel="noopener">coldstorage qak</a></p>
<h5 data-heading="Ticket">Ticket</h5>
<p>Ticket conterrà TIME, PESO e SEQ. La stringa sarà composta da questi 3 valori separati da "_" ed inizierà con "T":</p>
<pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token keyword">int</span> TIME
<span class="token keyword">int</span> PESO
<span class="token keyword">int</span> SEQ

<span class="token class-name">Ticket</span> <span class="token operator">=</span> <span class="token string">"T"</span><span class="token operator">+</span><span class="token string">"_"</span><span class="token operator">+</span>TIME<span class="token operator">+</span><span class="token string">"_"</span><span class="token operator">+</span>PESO<span class="token operator">+</span><span class="token string">"_"</span><span class="token operator">+</span>SEQ           #esempio di ticket<span class="token operator">:</span> T_1697643071_15_0
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="Definizione messaggi e contesti">Definizione messaggi e contesti</h5>
<pre><code>System coldstorage2

//-----------------------------------------------------------------------

...

//-----------------------------------------------------------------------

Request depositRequest : depositRequest(PESO)
Reply accept : accept(TICKET) for depositRequest
Reply reject : reject(NO_PARAM) for depositRequest

Request weightrequest : weightrequest(PESO)
Reply weightOK : weightOK( NO_PARAM ) for weightrequest
Reply weightKO : weightKO( NO_PARAM ) for weightrequest

Request checkmyticket : checkmyticket(TICKET)
Reply	ticketchecked : ticketchecked(BOOL) for checkmyticket

Request loaddone : loaddone(PESO)
Reply 	chargetaken : chargetaken(NO_PARAM) for loaddone

Request getweight : getweight(NO_PARAM)
Reply 	currentweight : currentweight(PESO_EFF,PESO_PRO)  for getweight

Dispatch startToDoThings : startToDoThings( NO_PARAM )

//-----------------------------------------------------------------------

Context ctxcoldstoragearea ip [host="localhost" port=8040]

//-----------------------------------------------------------------------
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="Controller">Controller</h5>
<p>Rispetto allo sprint 1 non abbiamo più bisogno della mockRequest e gestiamo il <a data-tooltip-position="top" aria-label="Sprint 1.1 - V3 > Problema del peso ipotetico" data-href="Sprint 1.1 - V3#Problema del peso ipotetico" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint%201.1%20-%20V3#Problema%20del%20peso%20ipotetico" class="internal-link" target="_blank" rel="noopener">problema del peso ipotetico</a>.</p>
<pre><code>QActor controller context ctxcoldstoragearea {

	[# var P_EFF = 0
	   var P_DIC = 0 
	#]
	
	State s0 initial { printCurrentMessage } Goto work
	
	State work{
		println("controller - in attesa") color green
	} Transition t0 whenRequest loaddone -&gt; startjob
	
	State startjob  {
		onMsg(loaddone : loaddone(PESO) ){
			[# PESO = payloadArg(0).toInt()	#]
		}
		replyTo loaddone with chargetaken : chargetaken( NO_PARAM )
		request transporttrolley -m doJob : doJob($P_EFF)
	} Transition endjob whenReply robotDead -&gt; handlerobotdead
						whenReply jobdone -&gt; jobdone
	
	State jobdone{
		forward coldroom -m updateWeight : updateWeight($P_EFF, $P_PROM)
	} Transition repeat -&gt; work
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="ColdRoom">ColdRoom</h5>
<p>Rispetto allo sprint precedente ColdRoom deve verificare se è presente abbastanza spazio e rispondere di conseguenza.<br>
UpdateWeight inoltre deve essere aggiornato per gestire il <a data-tooltip-position="top" aria-label="Sprint 1.1 - V3 > Problema del peso ipotetico" data-href="Sprint 1.1 - V3#Problema del peso ipotetico" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint%201.1%20-%20V3#Problema%20del%20peso%20ipotetico" class="internal-link" target="_blank" rel="noopener">problema del peso ipotetico</a>.<br>
Il peso promesso viene sottratto, se va aumentato fornire <strong>P_PRO negativo</strong>.</p>
<pre><code>QActor coldroom context ctxcoldstoragearea {
	...
	
	State checkweight {
		onMsg(weightrequest : weightrequest(PESO)){
			[# var PesoRichiesto = payloadArg(0).toInt() #]
			if [# PesoEffettivo + PesoPromesso + PesoRichiesto  &lt;= MAXW #]	{
				[# PesoPromesso += PesoRichiesto #]
				replyTo weightrequest with weightOK : weightOK( NO_PARAM)
			} else {
				replyTo weightrequest with weightKO : weightKO( NO_PARAM )
			}
		}
	} Goto work
	
	State returnweight{
		onMsg(getweight : getweight(NO_PARAM)){
			replyTo getweight with currentweight : currentweight($PesoEffettivo, $PesoPromesso)
		}
	} Goto work	
   
	State updateWeight {
		onMsg ( updateWeight : updateWeight(P_EFF, P_PRO) ) {
			[#  PesoEffettivo += payloadArg(0).toInt()
				PesoPromesso -= payloadArg(1).toInt()
			#]
		}
	} Goto work
}
</code><button class="copy-code-button">Copy</button></pre>
<h5 data-heading="TicketHandler">TicketHandler</h5>
<p><a data-tooltip-position="top" aria-label="Sprint1.1/Codice/ColdStorageSprint2/src/coldstorage.qak" data-href="Sprint1.1/Codice/ColdStorageSprint2/src/coldstorage.qak" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\ColdStorageSprint2\src\coldstorage.qak" class="internal-link" target="_blank" rel="noopener">coldstorage qak</a> </p>
<h5 data-heading="Parametrizzazione valori">Parametrizzazione valori</h5>
<p><a data-tooltip-position="top" aria-label="Sprint1.1/Codice/ColdStorageSprint2/resources/DomainSystemConfig.kt" data-href="Sprint1.1/Codice/ColdStorageSprint2/resources/DomainSystemConfig.kt" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\ColdStorageSprint2\resources\DomainSystemConfig.kt" class="internal-link" target="_blank" rel="noopener">DomainSystemConfig.kt</a> </p>
<h5 data-heading="Spring Server: socket e observer">Spring Server: socket e observer</h5>
<p>Il server si collegherà agli attori tramite socket o come coapObserver.<br>
Le richieste ajax provenienti dai client verranno inoltrate tramite socket.</p>
<p>Il server è composto di un <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ApiController.java" data-href="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ApiController.java" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\serviceaccessgui\src\main\java\unibo\serviceaccessgui\ApiController.java" class="internal-link" target="_blank" rel="noopener">ApiController.java</a> che sfrutta la classe <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/MessageSender.java" data-href="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/MessageSender.java" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\serviceaccessgui\src\main\java\unibo\serviceaccessgui\MessageSender.java" class="internal-link" target="_blank" rel="noopener">MessageSender</a> per inviare messaggi.<br>
Lato client rendiamo le pagine dinamiche tramite <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ApiController.java" data-href="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ApiController.java" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\serviceaccessgui\src\main\java\unibo\serviceaccessgui\ApiController.java" class="internal-link" target="_blank" rel="noopener">ApiController.java</a> </p>
<p>Gli eventi degli attori osservati tramite observer verranno inoltrati ai client tramite websocket, create all'inizio di ogni sessione. Vedi <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/serviceaccessgui/src/main/resources/static/js/dinamic.js" data-href="Sprint1.1/Codice/serviceaccessgui/src/main/resources/static/js/dinamic.js" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\serviceaccessgui\src\main\resources\static\js\dinamic.js" class="internal-link" target="_blank" rel="noopener">dinamic.js</a>.</p>
<h5 data-heading="HTML page">HTML page</h5>
<p><a data-tooltip-position="top" aria-label="Sprint1.1/ServiceAccessGuiWebPage.html" data-href="Sprint1.1/ServiceAccessGuiWebPage.html" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\ServiceAccessGuiWebPage.html" class="internal-link" target="_blank" rel="noopener">ServiceAccessGuiWebPage.html</a></p>
<h3 data-heading="Deployment">Deployment</h3>
<ol>
<li>Avviare il container itunibovirtualrobot23 su docker<br>
Viene lanciato l'ambiente virtuale con il robot all'indirizzo http://localhost:8090/</li>
<li>In intellij avviare il file <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/BasicRobotSprint2/src/it/unibo/ctxbasicrobot/MainCtxbasicrobot.kt" data-href="Sprint1.1/Codice/BasicRobotSprint2/src/it/unibo/ctxbasicrobot/MainCtxbasicrobot.kt" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\BasicRobotSprint2\src\it\unibo\ctxbasicrobot\MainCtxbasicrobot.kt" class="internal-link" target="_blank" rel="noopener">MainCtxbasicrobot.kt</a> del progetto BasicRobot</li>
<li>In intellij avviare il file <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/ColdStorageSprint2/src/it/unibo/ctxcoldstoragearea/MainCtxcoldstoragearea.kt" data-href="Sprint1.1/Codice/ColdStorageSprint2/src/it/unibo/ctxcoldstoragearea/MainCtxcoldstoragearea.kt" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\ColdStorageSprint2\src\it\unibo\ctxcoldstoragearea\MainCtxcoldstoragearea.kt" class="internal-link" target="_blank" rel="noopener">MainCtxcoldstoragearea.kt</a> del progetto ColdStorage</li>
<li>In intellij avviare il file <a data-tooltip-position="top" aria-label="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ServiceaccessguiApplication.java" data-href="Sprint1.1/Codice/serviceaccessgui/src/main/java/unibo/serviceaccessgui/ServiceaccessguiApplication.java" href="C:\Users\Proprietario\Desktop\ColdStorageService-XMas23\Sprint1.1\Doc\Sprint1.1\Codice\serviceaccessgui\src\main\java\unibo\serviceaccessgui\ServiceaccessguiApplication.java" class="internal-link" target="_blank" rel="noopener">ServiceaccessguiApplication.java</a> del progetto serviceaccessgui. Aprire il client all'indirizzo http://localhost:8085/</li>
</ol>
<h1 data-heading=""></h1>
<hr>
<p><a data-tooltip-position="top" aria-label="https://github.com/Lombax99/ColdStorageService-XMas23" rel="noopener" class="external-link" href="https://github.com/Lombax99/ColdStorageService-XMas23" target="_blank">Repo Github</a></p>
<table>
<thead>
<tr>
<th>Lisa Innocenti Uccini</th>
<th>Luca Lombardi</th>
<th>Giacomo Romanini</th>
</tr>
</thead>
<tbody>
<tr>
<td><img width="180" alt="LisaUccini.png" src="LisaUccini.png" class="internal-embed"></td>
<td><img width="245" alt="LucaLombardi.jpg" src="LucaLombardi.jpg" class="internal-embed"></td>
<td><img width="180" alt="GiacomoRomanini.jpg" src="GiacomoRomanini.jpg" class="internal-embed"></td>
</tr>
<tr>
<td><a data-tooltip-position="top" aria-label="https://github.com/LisaIU00" rel="noopener" class="external-link" href="https://github.com/LisaIU00" target="_blank">github: LisaIU00</a></td>
<td><a data-tooltip-position="top" aria-label="https://github.com/Lombax99" rel="noopener" class="external-link" href="https://github.com/Lombax99" target="_blank">github: Lombax99</a></td>
<td><a data-tooltip-position="top" aria-label="https://github.com/RedDuality" rel="noopener" class="external-link" href="https://github.com/RedDuality" target="_blank">github: RedDuality</a></td>
</tr>
</tbody>
</table>
    </body>
</html>